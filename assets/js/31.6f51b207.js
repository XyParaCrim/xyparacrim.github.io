(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{510:function(a,t,e){"use strict";e.r(t);var s=e(4),v=Object(s.a)({},(function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"redis内存对象"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redis内存对象"}},[a._v("#")]),a._v(" Redis内存对象")]),a._v(" "),e("div",{staticClass:"custom-block danger"},[e("p",[a._v("Redis是如何在内存中储存大量数据的？")])]),a._v(" "),e("h2",{attrs:{id:"位数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#位数"}},[a._v("#")]),a._v(" 位数")]),a._v(" "),e("ul",[e("li",[a._v("内存不超过4G，考虑是32bit进行编译\n"),e("ul",[e("li",[a._v("可使用的指针空间少一半")])])])]),a._v(" "),e("h2",{attrs:{id:"ziplist"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ziplist"}},[a._v("#")]),a._v(" ZipList")]),a._v(" "),e("div",{staticClass:"custom-block danger"},[e("p",[a._v("暂缺")])]),a._v(" "),e("h2",{attrs:{id:"key回收"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#key回收"}},[a._v("#")]),a._v(" Key回收")]),a._v(" "),e("p",[a._v("Redis将"),e("strong",[a._v("设置过期时间")]),a._v("的Key放入一个独立的字典里，会通过定时加惰性删除的方式，清理Key")]),a._v(" "),e("h3",{attrs:{id:"惰性删除"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#惰性删除"}},[a._v("#")]),a._v(" 惰性删除")]),a._v(" "),e("p",[a._v("客户端访问Key时，发现Key过期，则将其删除")]),a._v(" "),e("h3",{attrs:{id:"定时删除"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#定时删除"}},[a._v("#")]),a._v(" 定时删除")]),a._v(" "),e("p",[a._v("Redis默认每秒进行10次过期扫描，但是不会全遍历字典，而是采用贪心策略：")]),a._v(" "),e("ol",[e("li",[a._v("从过期字典中，随机选出20个Key")]),a._v(" "),e("li",[a._v("删除这20中过期的Key")]),a._v(" "),e("li",[a._v("若过期比例超出1/4，重复1")])]),a._v(" "),e("blockquote",[e("p",[a._v("每次扫描限制在25ms中")])]),a._v(" "),e("blockquote",[e("p",[a._v("从节点不会主动扫描，会根据主节点的del指令")])]),a._v(" "),e("h3",{attrs:{id:"异步回收"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#异步回收"}},[a._v("#")]),a._v(" 异步回收")]),a._v(" "),e("ul",[e("li",[a._v("unlink指令可以切断key和value的联系，执行异步回收")]),a._v(" "),e("li",[a._v("AOF可以异步执行")]),a._v(" "),e("li",[a._v("flushall async")])]),a._v(" "),e("p",[a._v("配置")]),a._v(" "),e("ol",[e("li",[a._v("slave-lazy-flush：从节点接收完rdb文件后的flush操作")]),a._v(" "),e("li",[a._v("lazyfree-lazy-eviction：内存达到maxmemory时进行淘汰")]),a._v(" "),e("li",[a._v("lazyfree-lazy-expire key：过期删除")]),a._v(" "),e("li",[a._v("lazyfree-lazy-server-del rename：指令删除")])])])}),[],!1,null,null,null);t.default=v.exports}}]);