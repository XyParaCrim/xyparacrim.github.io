(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{502:function(s,e,a){"use strict";a.r(e);var t=a(4),r=Object(t.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"rediskey查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rediskey查询"}},[s._v("#")]),s._v(" RedisKey查询")]),s._v(" "),a("blockquote",[a("p",[s._v("💔💔💔")]),s._v(" "),a("p",[s._v("如果没有可视化工具，应该怎么样查询Redis有哪些key呢？盲目查询又会带来哪些不好的影响呢？")])]),s._v(" "),a("h2",{attrs:{id:"keys"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#keys"}},[s._v("#")]),s._v(" "),a("code",[s._v("Keys")])]),s._v(" "),a("p",[s._v("我们可以使用"),a("code",[s._v("keys")]),s._v("查询redis中有哪些key，支持正则")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:639"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("7")]),s._v(">")]),s._v(" keys *\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("但是如果key很多时，redis会全部扫描，但是服务停顿")]),s._v(" "),a("h2",{attrs:{id:"scan"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scan"}},[s._v("#")]),s._v(" "),a("code",[s._v("Scan")])]),s._v(" "),a("p",[a("code",[s._v("Scan")]),s._v("可以定数目扫描，与Elasticsearch的scroll一样。例如从0个slot开始，扫描1000个slot元素进行匹配")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:639"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("7")]),s._v(">")]),s._v(" scan "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" match hh* count "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"redis-key的储存结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis-key的储存结构"}},[s._v("#")]),s._v(" Redis key的储存结构")]),s._v(" "),a("p",[s._v("在Redis中key储存在一个很大的字典里，与Java的HashMap一样，所以"),a("code",[s._v("Scan")]),s._v("参数都是slot。与HashMap相似，当元素数量达到LoadFactor阀值时，进行2倍\n扩容，同样也是渐进rehash。")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",[a("code",[s._v("Scan")]),s._v("的slot索引顺序是高位进位的方式，例如0000 -> 1000 -> 0100的方式，这是因为渐进rehash的原因")])]),s._v(" "),a("h3",{attrs:{id:"其他指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他指令"}},[s._v("#")]),s._v(" 其他指令")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("zscan")])]),s._v(" "),a("li",[a("code",[s._v("hsczn")])]),s._v(" "),a("li",[a("code",[s._v("sscan")])])]),s._v(" "),a("h2",{attrs:{id:"用途"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用途"}},[s._v("#")]),s._v(" 用途")]),s._v(" "),a("p",[s._v("业务中需要尽量避免使用大Key，因为会导致服务卡顿，所以需要定位。原始的方法使用scan获取key及其大小，再用相应数据结构进行排序。\nRedis提供指令")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("redis-cli -h "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(" --bigkeys\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("同时可以增加休眠参数，例如，每隔100条scan指令休眠0.1s")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("redis-cli -h "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(" --bigkeys -i "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])}),[],!1,null,null,null);e.default=r.exports}}]);