(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{507:function(s,t,a){"use strict";a.r(t);var e=a(4),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"redis集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis集群"}},[s._v("#")]),s._v(" Redis集群")]),s._v(" "),a("p",[s._v("详细记录Redis集群特性")]),s._v(" "),a("h2",{attrs:{id:"主备模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主备模式"}},[s._v("#")]),s._v(" 主备模式")]),s._v(" "),a("p",[s._v("宕机后需要手动切换机器")]),s._v(" "),a("h3",{attrs:{id:"一致性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一致性"}},[s._v("#")]),s._v(" 一致性")]),s._v(" "),a("p",[s._v("Redis是"),a("strong",[s._v("异步同步")]),s._v("的方式同步主从数据，所以不满足一致性，即"),a("strong",[s._v("CP")]),s._v("，但是从节点会尽力追上主节点。")]),s._v(" "),a("h3",{attrs:{id:"同步方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同步方式"}},[s._v("#")]),s._v(" 同步方式")]),s._v(" "),a("ul",[a("li",[s._v("主从同步")]),s._v(" "),a("li",[s._v("从从同步 "),a("Badge",{attrs:{text:"后续推出",type:"warning"}})],1)]),s._v(" "),a("h3",{attrs:{id:"增量同步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#增量同步"}},[s._v("#")]),s._v(" 增量同步")]),s._v(" "),a("p",[s._v("主节点使用环形内存Buffer记录定数量的指令，主节点将指定发送给从节点，从节点重放指令并反馈同步位置")]),s._v(" "),a("h3",{attrs:{id:"快照同步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#快照同步"}},[s._v("#")]),s._v(" 快照同步")]),s._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",[s._v("快照同步是一个非常消耗资源的操作")])]),s._v(" "),a("ol",[a("li",[s._v("主节点进行"),a("code",[s._v("bgsave")]),s._v("操作，当前内存数据全部快照到磁盘")]),s._v(" "),a("li",[s._v("将快照数据发送给从节点")]),s._v(" "),a("li",[s._v("从节点需要情况节点数据，然后再加载快照")])]),s._v(" "),a("p",[s._v("显然，若从节点在加载快照数据时，主节点的buffe不够，会造成重新快照的循环，所以buffer配置大小很关键")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",[s._v("Redis现在支持快照同步不通过磁盘，直接写入套接字中")])]),s._v(" "),a("h3",{attrs:{id:"wait"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wait"}},[s._v("#")]),s._v(" wait")]),s._v(" "),a("p",[s._v("wait指令可以保证同步同步")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" key value\nOK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wait")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("1：从节点个数")]),s._v(" "),a("li",[s._v("0：表示等待时间")])]),s._v(" "),a("h2",{attrs:{id:"sentinel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sentinel"}},[s._v("#")]),s._v(" Sentinel")]),s._v(" "),a("p",[s._v("相当于Redis路由，保证可用实例")]),s._v(" "),a("ul",[a("li",[s._v("监控健康")]),s._v(" "),a("li",[s._v("选择可用实例")]),s._v(" "),a("li",[s._v("进行选举，保证主备")])]),s._v(" "),a("h3",{attrs:{id:"数据丢失"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据丢失"}},[s._v("#")]),s._v(" 数据丢失")]),s._v(" "),a("p",[s._v("若主从延迟特别大，则会丢失大量数据，虽然无法保证不丢失，但是可以使用以下两个参数，尽量防止延迟：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("min-slaves-to-write 1\nmin-slaves-max-lag 10\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("min-slaves-to-write：至少保证一个从节点正常复制，否则暂停可用性")]),s._v(" "),a("li",[s._v("min-slaves-max-lag：表示指定时间内从节点未反馈，表示无法正常复制")])]),s._v(" "),a("blockquote",[a("p",[s._v("当主从切换后，旧主节点会抛出ReadonlyError异常，保证数据不被破坏")])]),s._v(" "),a("h2",{attrs:{id:"redis-cluster"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis-cluster"}},[s._v("#")]),s._v(" Redis Cluster")]),s._v(" "),a("ul",[a("li",[s._v("Redis Cluster共分为三个对等的部分（无主从），每个部分可以由一个实例或一个集群组成。")]),s._v(" "),a("li",[s._v("它们通过独特二进制协议通讯，并将所有数据分为16384个槽位。")]),s._v(" "),a("li",[s._v("key的定位通过客户端缓存其槽位信息，并在槽位不一致时，校正调整。")])]),s._v(" "),a("blockquote",[a("p",[s._v("节点需要配置信息持久化到配置文件中，必须保证配置文件可写的权限")])])])}),[],!1,null,null,null);t.default=r.exports}}]);