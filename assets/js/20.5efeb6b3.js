(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{498:function(s,a,t){"use strict";t.r(a);var e=t(4),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"redis主备模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis主备模式"}},[s._v("#")]),s._v(" Redis主备模式")]),s._v(" "),t("p",[s._v("详细记录Redis主备模式特性")]),s._v(" "),t("h2",{attrs:{id:"主备模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主备模式"}},[s._v("#")]),s._v(" 主备模式")]),s._v(" "),t("p",[s._v("宕机后需要手动切换机器")]),s._v(" "),t("h3",{attrs:{id:"一致性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一致性"}},[s._v("#")]),s._v(" 一致性")]),s._v(" "),t("p",[s._v("Redis是"),t("strong",[s._v("异步同步")]),s._v("的方式同步主从数据，所以不满足一致性，即"),t("strong",[s._v("CP")]),s._v("，但是从节点会尽力追上主节点。")]),s._v(" "),t("h3",{attrs:{id:"同步方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#同步方式"}},[s._v("#")]),s._v(" 同步方式")]),s._v(" "),t("ul",[t("li",[s._v("主从同步")]),s._v(" "),t("li",[s._v("从从同步 "),t("Badge",{attrs:{text:"后续推出",type:"warning"}})],1)]),s._v(" "),t("h3",{attrs:{id:"增量同步"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#增量同步"}},[s._v("#")]),s._v(" 增量同步")]),s._v(" "),t("p",[s._v("主节点使用环形内存Buffer记录定数量的指令，主节点将指定发送给从节点，从节点重放指令并反馈同步位置")]),s._v(" "),t("h3",{attrs:{id:"快照同步"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#快照同步"}},[s._v("#")]),s._v(" 快照同步")]),s._v(" "),t("div",{staticClass:"custom-block danger"},[t("p",[s._v("快照同步是一个非常消耗资源的操作")])]),s._v(" "),t("ol",[t("li",[s._v("主节点进行"),t("code",[s._v("bgsave")]),s._v("操作，当前内存数据全部快照到磁盘")]),s._v(" "),t("li",[s._v("将快照数据发送给从节点")]),s._v(" "),t("li",[s._v("从节点需要情况节点数据，然后再加载快照")])]),s._v(" "),t("p",[s._v("显然，若从节点在加载快照数据时，主节点的buffe不够，会造成重新快照的循环，所以buffer配置大小很关键")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",[s._v("Redis现在支持快照同步不通过磁盘，直接写入套接字中")])]),s._v(" "),t("h3",{attrs:{id:"wait"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#wait"}},[s._v("#")]),s._v(" wait")]),s._v(" "),t("p",[s._v("wait指令可以保证同步同步")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" key value\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wait")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ul",[t("li",[s._v("1：从节点个数")]),s._v(" "),t("li",[s._v("0：表示等待时间")])]),s._v(" "),t("h2",{attrs:{id:"sentinel"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sentinel"}},[s._v("#")]),s._v(" Sentinel")]),s._v(" "),t("p",[s._v("相当于Redis路由，保证可用实例")]),s._v(" "),t("ul",[t("li",[s._v("监控健康")]),s._v(" "),t("li",[s._v("选择可用实例")]),s._v(" "),t("li",[s._v("进行选举，保证主备")])]),s._v(" "),t("h3",{attrs:{id:"数据丢失"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据丢失"}},[s._v("#")]),s._v(" 数据丢失")]),s._v(" "),t("p",[s._v("若主从延迟特别大，则会丢失大量数据，虽然无法保证不丢失，但是可以使用以下两个参数，尽量防止延迟：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("min-slaves-to-write 1\nmin-slaves-max-lag 10\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("min-slaves-to-write：至少保证一个从节点正常复制，否则暂停可用性")]),s._v(" "),t("li",[s._v("min-slaves-max-lag：表示指定时间内从节点未反馈，表示无法正常复制")])]),s._v(" "),t("blockquote",[t("p",[s._v("当主从切换后，旧主节点会抛出ReadonlyError异常，保证数据不被破坏")])])])}),[],!1,null,null,null);a.default=r.exports}}]);